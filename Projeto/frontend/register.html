<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastre-se</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/css/login.css">

  <!-- DEPENDENCES -->
  <script src="/js/axios.min.js"></script>
  <script src="/js/notiflix-3.2.5.min.js"></script>
  <link rel="stylesheet" href="css/notiflix-3.2.5.min.css">
</head>

<body>
  <main>
    <aside class="register">
    </aside>
    <section>
      <form>
        <picture class="logo">
          <img src="/assets/logo.png" alt="Logo">
        </picture>
        <h1>Faça seu cadastro</h1>

        <div class="form-group">

          <svg class="icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
            stroke-linecap="round" stroke-linejoin="round" size="20" height="20" width="20"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <input type="text" name="name" placeholder="Nome">
          <div class="error" data-name>
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="19" viewBox="0 0 22 19" fill="none">
              <path
                d="M9.36333 1.9188L1.25652 15.4525C1.08903 15.7396 1.00097 16.0746 1.00001 16.4C0.999051 16.735 1.08519 17.07 1.25077 17.3572C1.41635 17.6443 1.65563 17.8931 1.94372 18.0558C2.23181 18.2281 2.55915 18.3239 2.89319 18.3239H19.1068C19.4408 18.3239 19.7682 18.2281 20.0563 18.0558C20.3444 17.8931 20.5836 17.6443 20.7492 17.3572C20.9148 17.07 21.0009 16.735 21 16.4C20.999 16.0746 20.911 15.7396 20.7435 15.4525L12.6367 1.9188C12.4663 1.64123 12.2261 1.40199 11.9389 1.23928C11.6527 1.08614 11.3292 1 11 1C10.6708 1 10.3473 1.08614 10.0611 1.23928C9.77394 1.40199 9.5337 1.64123 9.36333 1.9188Z"
                stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 6.83853V10.667" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 14.4955H11.01" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>
            </span>
          </div>

        </div>

        <div class="form-group">

          <svg class="icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
            stroke-linecap="round" stroke-linejoin="round" size="20" height="20" width="20"
            xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          <input type="text" name="email" placeholder="E-mail">
          <div class="error" data-email>
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="19" viewBox="0 0 22 19" fill="none">
              <path
                d="M9.36333 1.9188L1.25652 15.4525C1.08903 15.7396 1.00097 16.0746 1.00001 16.4C0.999051 16.735 1.08519 17.07 1.25077 17.3572C1.41635 17.6443 1.65563 17.8931 1.94372 18.0558C2.23181 18.2281 2.55915 18.3239 2.89319 18.3239H19.1068C19.4408 18.3239 19.7682 18.2281 20.0563 18.0558C20.3444 17.8931 20.5836 17.6443 20.7492 17.3572C20.9148 17.07 21.0009 16.735 21 16.4C20.999 16.0746 20.911 15.7396 20.7435 15.4525L12.6367 1.9188C12.4663 1.64123 12.2261 1.40199 11.9389 1.23928C11.6527 1.08614 11.3292 1 11 1C10.6708 1 10.3473 1.08614 10.0611 1.23928C9.77394 1.40199 9.5337 1.64123 9.36333 1.9188Z"
                stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 6.83853V10.667" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 14.4955H11.01" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>
            </span>
          </div>

        </div>

        <div class="form-group">

          <svg class="icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
            stroke-linecap="round" stroke-linejoin="round" size="20" height="20" width="20"
            xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <input type="password" name="password" placeholder="Senha">
          <div class="error" data-password>
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="19" viewBox="0 0 22 19" fill="none">
              <path
                d="M9.36333 1.9188L1.25652 15.4525C1.08903 15.7396 1.00097 16.0746 1.00001 16.4C0.999051 16.735 1.08519 17.07 1.25077 17.3572C1.41635 17.6443 1.65563 17.8931 1.94372 18.0558C2.23181 18.2281 2.55915 18.3239 2.89319 18.3239H19.1068C19.4408 18.3239 19.7682 18.2281 20.0563 18.0558C20.3444 17.8931 20.5836 17.6443 20.7492 17.3572C20.9148 17.07 21.0009 16.735 21 16.4C20.999 16.0746 20.911 15.7396 20.7435 15.4525L12.6367 1.9188C12.4663 1.64123 12.2261 1.40199 11.9389 1.23928C11.6527 1.08614 11.3292 1 11 1C10.6708 1 10.3473 1.08614 10.0611 1.23928C9.77394 1.40199 9.5337 1.64123 9.36333 1.9188Z"
                stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 6.83853V10.667" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 14.4955H11.01" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>
            </span>
          </div>

        </div>

        <div class="form-group">

          <svg class="icon" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
            stroke-linecap="round" stroke-linejoin="round" size="20" height="20" width="20"
            xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <input type="password" name="password_confirm" placeholder="Confirma senha">
          <div class="error" data-password_confirm>
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="19" viewBox="0 0 22 19" fill="none">
              <path
                d="M9.36333 1.9188L1.25652 15.4525C1.08903 15.7396 1.00097 16.0746 1.00001 16.4C0.999051 16.735 1.08519 17.07 1.25077 17.3572C1.41635 17.6443 1.65563 17.8931 1.94372 18.0558C2.23181 18.2281 2.55915 18.3239 2.89319 18.3239H19.1068C19.4408 18.3239 19.7682 18.2281 20.0563 18.0558C20.3444 17.8931 20.5836 17.6443 20.7492 17.3572C20.9148 17.07 21.0009 16.735 21 16.4C20.999 16.0746 20.911 15.7396 20.7435 15.4525L12.6367 1.9188C12.4663 1.64123 12.2261 1.40199 11.9389 1.23928C11.6527 1.08614 11.3292 1 11 1C10.6708 1 10.3473 1.08614 10.0611 1.23928C9.77394 1.40199 9.5337 1.64123 9.36333 1.9188Z"
                stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 6.83853V10.667" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M11 14.4955H11.01" stroke="#ED1651" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <span>
            </span>
          </div>

        </div>

        <button type="submit">Cadastrar</button>

        <span class="new-account">
          Já possui uma conta? <br>
          <a href="/login.html">Clique aqui</a> para entrar.
        </span>
      </form>
    </section>
  </main>

  <script type="module">
    import { API_ROUTES } from '/js/routes.js';

    const form = document.querySelector('form');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      var data = new FormData(form);
      data = Object.fromEntries(data);
      var isValid = true;

      const nameError = document.querySelector('[data-name]');
      if (!data.name) {
        isValid = false;
        nameError.classList.add('on-error');
        let span = nameError.querySelector('span');
        span.innerHTML = 'Preencha seu nome';
      } else {
        nameError.classList.remove('on-error');
      }

      const emailError = document.querySelector('[data-email]');
      if (!data.email) {
        isValid = false;
        emailError.classList.add('on-error');
        let span = emailError.querySelector('span');
        span.innerHTML = 'Preencha seu email';
      } else {
        emailError.classList.remove('on-error');
      }

      const passwordError = document.querySelector('[data-password]');
      if (!data.password) {
        isValid = false;
        passwordError.classList.add('on-error');
        let span = passwordError.querySelector('span');
        span.innerHTML = 'Preencha sua senha';
      } else {
        passwordError.classList.remove('on-error');
      }

      const passwordConfirmError = document.querySelector('[data-password_confirm]');
      if (!data.password_confirm || data.password_confirm !== data.password) {
        isValid = false;
        passwordConfirmError.classList.add('on-error');
        let span = passwordConfirmError.querySelector('span');
        span.innerHTML = 'Confirme sua senha';
      } else {
        passwordConfirmError.classList.remove('on-error');
      }

      if (isValid) {
        try {
          const response = await axios.post(API_ROUTES.REGISTER, data);
          Notiflix.Report.success('Cadastrado!', 'Cadastro efetuado com sucesso!', 'Ir para Login', () => {
            window.location.href = '/login.html';
          });

          console.log(response.data);
        } catch (error) {
          Notiflix.Notify.failure(error.response.data.message);
        }
      }
    });
  </script>

  <!-- <script type="module">
    import { registerValidation } from '/js/validation.js';
    import { API_ROUTES } from '/js/routes.js';
    const form = document.querySelector('form');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const obj = Object.fromEntries(formData);
      const { errors, hasError } = registerValidation(obj);

      for (let key in errors) {
        let input = e.target.querySelector(`[name="${key}"]`);
        // let errorSpan = e.target.querySelector(`[data-${key}]`);
        let divElement = input.nextElementSibling;
        let spanElement = divElement.children[1];
        if (!!errors[key]) {
          divElement.classList.add('on-error');
          spanElement.innerHTML = errors[key];
        } else {
          divElement.classList.remove('on-error');
          spanElement.innerHTML = '';
        }
      }

      if (!hasError) {
        try {
          Notiflix.Loading.circle();
          const response = await axios.post(API_ROUTES.REGISTER, obj);
          localStorage.setItem('@user', JSON.stringify(response.data));
          window.location.href = 'index.html';
        } catch (err) {
          const message = err?.response?.data?.message;
          if (message) {
            Notiflix.Notify.failure(message);
          } else {
            Notiflix.Notify.failure('Oops... Something is wrong, try again.')
          }
        } finally{
          Notiflix.Loading.remove();
        }
      }
    })
  </script> -->
</body>

</html>